FROM node:20-alpine

# Configuração de timezone
ENV TZ=America/Fortaleza

# Instalar dependências do sistema
RUN apk add --no-cache libc6-compat

WORKDIR /app

# Copiar package files
COPY package*.json ./

# Instalar todas as dependências (incluindo dev)
RUN npm install

# Copiar código
COPY . .

# Criar diretórios e ajustar permissões
RUN mkdir -p /app/.next && \
    chmod -R 755 /app

# Variáveis de ambiente
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV CHOKIDAR_USEPOLLING=true

EXPOSE 3000

CMD ["npm", "run", "dev"]